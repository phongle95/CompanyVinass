/*
  filename: integralui.rating.js
  version : 1.0.0
  Copyright Â© 2016-2018 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(d,b){function a(){this.constructor=d}for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);d.prototype=null===b?Object.create(b):(a.prototype=b.prototype,new a)},__decorate=this&&this.__decorate||function(d,b,a,e){var c=arguments.length,f=3>c?b:null===e?e=Object.getOwnPropertyDescriptor(b,a):e,g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(d,b,a,e);else for(var h=d.length-1;0<=h;h--)if(g=d[h])f=(3>c?g(f):3<c?g(b,a,f):
g(b,a))||f;return 3<c&&f&&Object.defineProperty(b,a,f),f},__metadata=this&&this.__metadata||function(d,b){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(d,b)},core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),forms_1=require("@angular/forms"),IntegralUIRating=IntegralUIRating_1=function(d){function b(a,b){var c=d.call(this,a,b)||this;c.elemRef=a;c.commonService=
b;c.ctrlMaxValue=5;c.currentStepSize=16;c.currentIncrement=integralui_core_1.IntegralUIIncrementMode.Free;c.isRatingChangeActive=!1;c.contentSize={width:0,height:0};c.ratingSize={width:0,height:0};c.ratingClass=[];return c}__extends(b,d);Object.defineProperty(b.prototype,"value",{get:function(){return this.currentValue},set:function(a){var b=Math.floor(a);switch(this.currentIncrement){case integralui_core_1.IntegralUIIncrementMode.Partial:a=a>b+.25?b+.5:a>b+.75?b+1:b;break;case integralui_core_1.IntegralUIIncrementMode.Full:a=
a>b+.5?a=b+1:b}a=Math.max(0,Math.min(this.ctrlMaxValue,a));a!==this.currentValue&&a<=this.ctrlMaxValue&&(this.currentValue=a,this.onChange(a),this.processValueChange(),this.valueChanged.emit({value:this.currentValue}))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"increment",{get:function(){return this.currentIncrement},set:function(a){this.currentIncrement!=a&&(this.currentIncrement=a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"max",{get:function(){return this.ctrlMaxValue},
set:function(a){a=Math.floor(a);this.ctrlMaxValue!=a&&(this.ctrlMaxValue=a,this.updateLayout())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stepSize",{get:function(){return this.currentStepSize},set:function(a){a=Math.floor(a);this.currentStepSize!=a&&1<=a&&(this.currentStepSize=a,this.updateLayout())},enumerable:!0,configurable:!0});b.prototype.ngOnInit=function(){this.generalClassName="iui-rating";this.contentClassName=this.generalClassName+"-content";this.ratingClassName=
this.generalClassName+"-value";this.initStyle()};b.prototype.ngAfterViewInit=function(){this.updateLayout()};b.prototype.initStyle=function(){this.defaultStyle={general:{disabled:this.generalClassName+"-disabled",focused:this.generalClassName+"-focused",normal:this.generalClassName,hovered:this.generalClassName+"-hovered",selected:this.generalClassName+"-selected"},content:{disabled:this.contentClassName+"-disabled",focused:this.contentClassName+"-focused",normal:this.contentClassName,hovered:this.contentClassName+
"-hovered",selected:this.contentClassName+"-selected"},rating:{disabled:this.ratingClassName+"-disabled",focused:this.ratingClassName+"-focused",normal:this.ratingClassName,hovered:this.ratingClassName+"-hovered",selected:this.ratingClassName+"-selected"}};this.updateStyle(this.controlStyle);this.updateControlClass();this.updateContentClass();this.updateRatingClass()};b.prototype.ngAfterContentChecked=function(){1==this.autoUpdate&&(this.clientRect={width:this.elemRef.nativeElement.firstElementChild.clientWidth,
height:this.elemRef.nativeElement.firstElementChild.clientHeight},this.clientRect.width!=this.prevClientRect.width?(this.updateLayout(),this.prevClientRect.width=this.clientRect.width):this.clientRect.height!=this.prevClientRect.height&&(this.updateLayout(),this.prevClientRect.height=this.clientRect.height))};b.prototype.getContentWidth=function(){return this.contentSize.width};b.prototype.getRatingWidth=function(){return this.ratingSize.width};b.prototype.processValueChange=function(){this.updateLayout()};
b.prototype.updateLayout=function(){var a=this,b=setTimeout(function(){var c=a.commonService.getPadding(a.elemRef.nativeElement.firstElementChild);a.clientRect={width:a.elemRef.nativeElement.firstElementChild.clientWidth-(c.left+c.right),height:a.elemRef.nativeElement.firstElementChild.clientHeight-(c.top+c.bottom)};a.contentSize={width:a.ctrlMaxValue*a.currentStepSize,height:a.clientRect.height};a.ratingSize={width:a.currentValue<a.ctrlMaxValue?a.currentValue*a.currentStepSize:a.contentSize.width,
height:a.clientRect.height};clearTimeout(b)},1)};b.prototype.ctrlMouseDown=function(a){this.isEnabled&&1==a.which&&(this.isRatingChangeActive=!0,this.value=a.offsetX/this.currentStepSize,this.updateLayout(),a.stopPropagation())};b.prototype.ctrlMouseMove=function(a){this.isEnabled&&1==a.which&&this.isRatingChangeActive&&(this.value=a.offsetX/this.currentStepSize,this.updateLayout(),a.stopPropagation())};b.prototype.ctrlMouseUp=function(a){this.isRatingChangeActive=!1};b.prototype.ctrlMouseWheel=function(a){this.isEnabled&&
(a.preventDefault(),this.value+=-1*Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)),a.stopPropagation())};b.prototype.onWindowMouseUp=function(a){this.isRatingChangeActive=!1};b.prototype.getRatingValueClass=function(){return this.ratingClass};b.prototype.updateRatingClass=function(){this.ratingClass.length=0;this.ratingClass.push(this.ratingClassName);this.options.currentStyle&&(this.ratingClass.push(this.options.currentStyle.rating.normal),this.state&integralui_core_1.IntegralUIObjectState.disabled?
this.ratingClass.push(this.options.currentStyle.rating.disabled):this.state&integralui_core_1.IntegralUIObjectState.focused?this.ratingClass.push(this.options.currentStyle.rating.focused):this.state&integralui_core_1.IntegralUIObjectState.selected?this.ratingClass.push(this.options.currentStyle.rating.selected):this.state&integralui_core_1.IntegralUIObjectState.hovered&&this.ratingClass.push(this.options.currentStyle.rating.hovered))};b.prototype.getRatingStyle=function(a){return this.commonService.isString(a)?
a:a?{disabled:this.commonService.isFieldAvailable(a.disabled,this.ratingClassName+"-disabled"),focused:this.commonService.isFieldAvailable(a.focused,this.ratingClassName+"-focused"),hovered:this.commonService.isFieldAvailable(a.hovered,this.ratingClassName+"-hovered"),normal:this.commonService.isFieldAvailable(a.normal,this.ratingClassName),selected:this.commonService.isFieldAvailable(a.selected,this.ratingClassName+"-selected")}:{disabled:this.defaultStyle.rating.disabled,focused:this.defaultStyle.rating.focused,
hovered:this.defaultStyle.rating.hovered,normal:this.defaultStyle.rating.normal,selected:this.defaultStyle.rating.selected}};b.prototype.updateStyle=function(a){this.options.currentStyle=a?{general:this.getGeneralStyle(a.general),content:this.getContentStyle(a.content),rating:this.getRatingStyle(a.rating)}:{general:{disabled:this.defaultStyle.general.disabled,focused:this.defaultStyle.general.focused,hovered:this.defaultStyle.general.hovered,normal:this.defaultStyle.general.normal,selected:this.defaultStyle.general.selected},
content:{disabled:this.defaultStyle.content.disabled,focused:this.defaultStyle.content.focused,hovered:this.defaultStyle.content.hovered,normal:this.defaultStyle.content.normal,selected:this.defaultStyle.content.selected},rating:{disabled:this.defaultStyle.rating.disabled,focused:this.defaultStyle.rating.focused,hovered:this.defaultStyle.rating.hovered,normal:this.defaultStyle.rating.normal,selected:this.defaultStyle.rating.selected}}};return b}(integralui_core_1.IntegralUIBaseValueComponent);
__decorate([core_1.Input(),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],IntegralUIRating.prototype,"increment",null);__decorate([core_1.Input(),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],IntegralUIRating.prototype,"max",null);__decorate([core_1.Input(),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],IntegralUIRating.prototype,"stepSize",null);
__decorate([core_1.HostListener("document:mouseup",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],IntegralUIRating.prototype,"onWindowMouseUp",null);
IntegralUIRating=IntegralUIRating_1=__decorate([core_1.Component({selector:"iui-rating",template:'\n\t\t<div [ngClass]="getControlClass()" (mousedown)="ctrlMouseDown($event)" (mousemove)="ctrlMouseMove($event)" (mouseup)="ctrlMouseUp($event)" (DOMMouseScroll)="ctrlMouseWheel($event)" (mousewheel)="ctrlMouseWheel($event)" [ngStyle]="{ width: getContentWidth() + \'px\' }">\n\t\t\t<div [ngClass]="getContentClass()" style="position:absolute" [ngStyle]="{ width: getContentWidth() + \'px\' }"></div>\n\t\t\t<div [ngClass]="getRatingValueClass()" style="position:absolute" [ngStyle]="{ width: getRatingWidth() + \'px\' }"></div>\n\t\t</div>\n\t',inputs:"autoUpdate controlStyle data enabled name state value".split(" "),
outputs:["valueChanged"],providers:[{provide:forms_1.NG_VALUE_ACCESSOR,useExisting:core_1.forwardRef(function(){return IntegralUIRating_1}),multi:!0}],encapsulation:core_1.ViewEncapsulation.None}),__metadata("design:paramtypes",[core_1.ElementRef,integralui_common_service_1.IntegralUICommonService])],IntegralUIRating);exports.IntegralUIRating=IntegralUIRating;var IntegralUIRating_1;