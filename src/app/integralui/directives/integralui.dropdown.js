/*
  filename: integralui.dropdown.js
  version : 1.4.0
  Copyright Â© 2016-2018 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(d,b){function a(){this.constructor=d}for(var c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);d.prototype=null===b?Object.create(b):(a.prototype=b.prototype,new a)},__decorate=this&&this.__decorate||function(d,b,a,c){var f=arguments.length,e=3>f?b:null===c?c=Object.getOwnPropertyDescriptor(b,a):c,g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)e=Reflect.decorate(d,b,a,c);else for(var h=d.length-1;0<=h;h--)if(g=d[h])e=(3>f?g(e):3<f?g(b,a,e):
g(b,a))||e;return 3<f&&e&&Object.defineProperty(b,a,e),e},__metadata=this&&this.__metadata||function(d,b){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(d,b)},core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),IntegralUIDropDownComponent=function(d){function b(a,b){var c=d.call(this,b)||this;c.elemRef=a;c.commonService=b;c.showTimer=null;
c.popupTimer=null;c.mousePos={x:0,y:0};c.dropdownDisplay="none";c.dropdownPos={top:0,left:0};c.dropdownSize={width:0,height:0};c.closed=new core_1.EventEmitter;c.updateOptions();return c}__extends(b,d);Object.defineProperty(b.prototype,"options",{get:function(){return this.dropdownOptions},set:function(a){this.updateOptions(a)},enumerable:!0,configurable:!0});b.prototype.ngAfterContentInit=function(){var a=this,b=setTimeout(function(){a.elemRef.nativeElement.firstElementChild.focus();clearTimeout(b)},
1)};b.prototype.ngOnDestroy=function(){};b.prototype.updateAdjustment=function(a){return a?{top:this.commonService.isFieldAvailable(a.top,0),right:this.commonService.isFieldAvailable(a.right,0),bottom:this.commonService.isFieldAvailable(a.bottom,0),left:this.commonService.isFieldAvailable(a.left,0)}:{top:0,right:0,bottom:0,left:0}};b.prototype.updateOptions=function(a){a?(this.dropdownOptions={adjustment:this.updateAdjustment(a.adjustment),autoClose:this.commonService.isFieldAvailable(a.autoClose,
!0),autoPopDelay:this.commonService.isFieldAvailable(a.autoPopDelay,5E3),enabled:this.commonService.isFieldAvailable(a.enabled,!0),initialDelay:this.commonService.isFieldAvailable(a.initialDelay,500),position:this.commonService.isFieldAvailable(a.position,"mouse"),showMarker:this.commonService.isFieldAvailable(a.showMarker,!0),title:this.commonService.isFieldAvailable(a.title,"")},this.updateDropDownSize(a.dropDownSize)):this.dropdownOptions={adjustment:this.updateAdjustment(),autoClose:!0,autoPopDelay:5E3,
enabled:!0,initialDelay:500,position:"mouse",showMarker:!0,title:""}};b.prototype.updateDropDownSize=function(a){a&&(this.dropdownOptions.dropDownSize={width:this.commonService.isFieldAvailable(a.width,0),height:this.commonService.isFieldAvailable(a.height,0)})};b.prototype.onBlur=function(a){0!=this.options.autoClose&&this.closed.emit(null)};b.prototype.onMouseDown=function(a){1==a.buttons&&this.closed.emit(null)};b.prototype.removeTimers=function(){this.showTimer&&(clearTimeout(this.showTimer),
this.showTimer=null);this.popupTimer&&(clearTimeout(this.popupTimer),this.popupTimer=null)};b.prototype.open=function(a,b,d){this.dropdownPos.top=-9999999;this.dropdownDisplay="block";this.dropdownSize=this.size();this.dropdownDisplay="none";this.removeTimers();this.dropdownOptions.enabled&&this.show(a,b,d)};b.prototype.show=function(a,b,d){this.dropdownPos={top:this.mousePos.y+24,left:this.mousePos.x};var c=this.commonService.getShiftPos();switch(this.dropdownOptions.position){case "above":this.dropdownPos=
{top:a.top-4-this.dropdownSize.height,left:a.left+Math.floor((b.width-this.dropdownSize.width)/2)};break;case "left":this.dropdownPos={top:a.top+Math.floor((b.height-this.dropdownSize.height)/2),left:a.left-4-this.dropdownSize.width};break;case "right":this.dropdownPos={top:a.top+Math.floor((b.height-this.dropdownSize.height)/2),left:a.right+4};break;default:this.dropdownPos={top:a.bottom+c.y+4+this.dropdownOptions.adjustment.top,left:a.left+c.x+this.dropdownOptions.adjustment.left},d&&this.dropdownPos.top+
this.dropdownSize.height>d.height&&(this.dropdownPos.top-=this.dropdownPos.top+this.dropdownSize.height-d.height)}this.dropdownDisplay="block"};b.prototype.size=function(){var a={width:this.elemRef.nativeElement.firstElementChild.offsetWidth,height:this.elemRef.nativeElement.firstElementChild.offsetHeight};this.options.dropDownSize&&(a.width=this.commonService.isFieldAvailable(this.options.dropDownSize.width,a.width),a.height=this.commonService.isFieldAvailable(this.options.dropDownSize.height,a.height));
return a};b.prototype.updateMousePos=function(a){this.mousePos!=a&&(this.mousePos=a)};b.prototype.updateControlClass=function(){this.ctrlClass.length=0;this.ctrlClass.push("iui-dropdown");if(this.dropdownOptions.showMarker)switch(this.dropdownOptions.position){case "above":this.ctrlClass.push("iui-dropdown-marker-bottom");break;case "right":this.ctrlClass.push("iui-dropdown-marker-left");break;case "below":this.ctrlClass.push("iui-dropdown-marker-top");break;case "left":this.ctrlClass.push("iui-dropdown-marker-right")}};
return b}(integralui_core_1.IntegralUIBaseComponent);__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],IntegralUIDropDownComponent.prototype,"options",null);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIDropDownComponent.prototype,"closed",void 0);
IntegralUIDropDownComponent=__decorate([core_1.Component({selector:"iui-dropdown",template:'\n\t\t<div class="iui-dropdown" [ngClass]="getControlClass()" [ngStyle]="{ \'top\': dropdownPos.top + \'px\', \'left\': dropdownPos.left + \'px\' }" (blur)="onBlur($event)" (mousedown)="onMouseDown($event)" tabindex="999">\n\t\t\t<ng-template ngFor [ngForOf]="[templateObj.data]" [ngForTemplate]="templateObj.template"></ng-template>\n\t\t</div>\n\t',inputs:["controlStyle","data","state"],encapsulation:core_1.ViewEncapsulation.None}),
__metadata("design:paramtypes",[core_1.ElementRef,integralui_common_service_1.IntegralUICommonService])],IntegralUIDropDownComponent);exports.IntegralUIDropDownComponent=IntegralUIDropDownComponent;
var IntegralUIDropDown=function(){function d(b,a,c){this.elemRef=b;this.cmpResolver=a;this.commonService=c;this.eventList=[];this.templateData=[];this.isDropDownOpen=!1;this.cmpRef=null;this.templateList=[];this.dropDownOpen=new core_1.EventEmitter;this.dropDownOpening=new core_1.EventEmitter;this.dropDownClose=new core_1.EventEmitter}Object.defineProperty(d.prototype,"showDropDown",{get:function(){return this.isDropDownOpen},set:function(b){this.isDropDownOpen!=b&&((this.isDropDownOpen=b)?this.open():
this.close())},enumerable:!0,configurable:!0});d.prototype.ngAfterContentInit=function(){this.templateList=this.templates.toArray();for(var b=0;b<this.templateList.length;b++)if(this.templateList[b].settings)switch(this.templateList[b].settings.type){case "dropdown":this.templateData.push(this.templateList[b].getTemplate())}};d.prototype.closeDropDown=function(){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(b){return b.unsubscribe()}),this.cmpRef.destroy());this.cmpRef=null;this.dropDownClose.emit(null)};
d.prototype.close=function(){this.closeDropDown()};d.prototype.open=function(b){var a=this,c=a.dropDownRef?a.dropDownRef:a.settings.appRef;if(c){var d={cancel:!1,event:b};a.dropDownOpening.emit(d);if(1!=d.cancel&&(d=a.cmpResolver.resolveComponentFactory(IntegralUIDropDownComponent))&&(a.cmpRef=c.createComponent(d),a.cmpRef&&(c=null,a.cmpRef._component?c=a.cmpRef._component:a.cmpRef._hostElement&&(c=a.cmpRef._hostElement.component),c))){c.options=a.settings;c.templateObj={data:a.settings.data,template:a.templateData[0]};
b&&c.updateMousePos(a.commonService.getMousePos(b));this.dropDownOpen.emit(null);d=a.settings.appSize?a.settings.appSize:{width:window.innerWidth,height:window.innerHeight};var e=this.elemRef.nativeElement.getBoundingClientRect();c.open(e,a.size(),d);a.eventList.push(c.closed.subscribe(function(b){a.closeDropDown()}));b&&b.stopPropagation()}}};d.prototype.size=function(){return{width:this.elemRef.nativeElement.offsetWidth,height:this.elemRef.nativeElement.offsetHeight}};d.prototype.onMouseDown=function(b){var a=
this.settings?1==this.settings.manual:!1;1!=b.which||a||(this.closeDropDown(),this.open(b))};return d}();__decorate([core_1.ContentChildren(integralui_core_1.IntegralUITemplate),__metadata("design:type",core_1.QueryList)],IntegralUIDropDown.prototype,"templates",void 0);__decorate([core_1.Input("iuiDropDown"),__metadata("design:type",Object)],IntegralUIDropDown.prototype,"settings",void 0);__decorate([core_1.Input(),__metadata("design:type",Object)],IntegralUIDropDown.prototype,"dropDownRef",void 0);
__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],IntegralUIDropDown.prototype,"showDropDown",null);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIDropDown.prototype,"dropDownOpen",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIDropDown.prototype,"dropDownOpening",void 0);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIDropDown.prototype,"dropDownClose",void 0);__decorate([core_1.HostListener("mousedown",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],IntegralUIDropDown.prototype,"onMouseDown",null);
IntegralUIDropDown=__decorate([core_1.Directive({selector:"[iuiDropDown]"}),__metadata("design:paramtypes",[core_1.ElementRef,core_1.ComponentFactoryResolver,integralui_common_service_1.IntegralUICommonService])],IntegralUIDropDown);exports.IntegralUIDropDown=IntegralUIDropDown;